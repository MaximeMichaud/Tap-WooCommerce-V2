includes:
    - vendor/szepeviktor/phpstan-wordpress/extension.neon

parameters:
    level: 8
    paths:
        - .
    excludePaths:
        - vendor/*
        - assets/*
        - tests/*
        - wp-admin/*
    scanFiles:
        - vendor/php-stubs/woocommerce-stubs/woocommerce-stubs.php
        - vendor/php-stubs/woocommerce-stubs/woocommerce-packages-stubs.php
    treatPhpDocTypesAsCertain: false
    reportUnmatchedIgnoredErrors: false

    # Documented ignores - same approach as dianxiaomi
    ignoreErrors:
        # Array value types - would require major refactoring to add proper types
        - '#no value type specified in iterable type array#'

        # WC_Tap_Gateway class defined inside tapwc_init_gateway_class() function
        # This is a WordPress pattern - class is loaded conditionally after plugins_loaded
        # TODO: Refactor to separate file
        - '#unknown class WC_Tap_Gateway#'
        - '#Instantiated class WC_Tap_Gateway not found#'

        # WordPress constant defined at runtime
        - '#Constant WP_PLUGIN_URL not found#'

        # Defensive WP_Error checks (intentional safety)
        - '#should return array but returns WP_Error#'
        - '#Instanceof between .* and WP_Error will always evaluate to false#'
        - '#Call to function is_wp_error\(\) with array will always evaluate to false#'

        # Legacy code - missing type specifications (would require major refactoring)
        - '#has no type specified#'
        - '#has no return type specified#'
        - '#has parameter .* with no type specified#'

        # wc_get_order() returns WC_Order|WC_Order_Refund|bool - legacy code assumes success
        # TODO: Add proper null checks
        - '#Cannot call method .* on bool\|WC_Order\|WC_Order_Refund#'

        # curl_exec and file_get_contents can return false
        - '#Parameter .* of function json_decode expects string, (string\|false|bool\|string) given#'

        # get_permalink can return false
        - '#Parameter .* of function wp_safe_redirect expects string, string\|false given#'

        # Variable exists but may be empty string (intentional check)
        - '#Variable \$tap_id in empty\(\) always exists and is not falsy#'

        # WordPress action callbacks - can return void or bool
        - '#Action callback returns bool but should not return anything#'

        # Property is set for potential future use
        - '#Property WC_Tap_Blocks_Support::\$asset_api is never read, only written#'

        # array_filter callback type mismatch - WooCommerce pattern
        - '#Parameter .* of function array_filter expects .*, array\{WC_Tap_Gateway, .*\} given#'

        # API response - json_decode returns mixed object structure
        - '#Access to an undefined property object::#'
